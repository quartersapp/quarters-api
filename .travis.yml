language: node_js
node_js:
- 6.10.3
cache:
  directories:
  - node_modules
addons:
  postgresql: '9.6'
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.8
    - g++-4.8
  code_climate:
    repo_token: $CODE_CLIMATE_TOKEN
branches:
  only:
  - master
before_script:
- psql -c 'create database quarters_test;' -U postgres
- psql -c "CREATE USER vagrant;" -U postgres
- npm run migrate-test
script: npm test -- --coverage
after_success:
  - npm install -g codeclimate-test-reporter
  - codeclimate-test-reporter < ./coverage/lcov.info
env:
  global:
  # LAMBDA_FUNCTION_NAME
  - secure: Ixj05lgD+eiiVF7aXBJiuDap4qxSVtTVrG5WBt94F2JPk3ast1jpWzhQ2pQDdpreL/HSiecXRrS1ESP3ThOLqjsG2rXdCG9FzJa+DhQX5IvMESw+ppy85uvdFJjPYuZeUMVozuv3/BCVyLMn+QXtMgINI3Zl+AmNlNtyfW8X97s0rw2WZxFAaqJTgy29ETW9/ovUJSAbHVHQ8e4FhjapV0ocXUhEZzEbm5B0hrIOsuVoP7Knsr3EFyKZXp+jwCiBUMpR8j09GZ57T0UucyPfoAbbwMrsr/+yrBFzrLJFLxfslgORqKhM9Kl2V5WQtY8O3UoBMKV2X/kPbXTwfMQ+6+0Dvi6QMikBQkerYktOSxFRsQAm3Z0aIm6AXjGz384U2Pc/Qm9tLg2RKfSPcSZIrMYlpPsA3HeE7zk88fdMa1ZgB7fyzrVbpa9UF8c0htaIDCVHxcsZdOtaWGf5TR3U+nYGSeM1akD7htHxqLT9IcA5YXZCIJ1RueWNnnliDZkWcGSliQ72W0rSTD/Xf136f9I/9Unxk+0YyWPxa/Lx0ehsrufs9GYbJd9fmsdKiPKBe/lu70qRnXGQ3PIM3G59yUaot1AW58FWm1qQvl9OD/5vvM+bjPsc/9PLqucHSMoRZ3N00hxf6za5PQONKT8gnIUHRDHzpNAx/D5j1Vavn40=
  # LAMBDA_REGION
  - secure: R2dQcw0R1OfpJYOKqeQW+PO84tLYcQPNGBUyAUpd+9OonVSoW6CKAtFNH5gaY19UvH29wS0qY6SzM0aGxi2OzSNItH9Pb2veUuYAe5OEk1UuKtSQYGkx61B7jkbNAJelGNISSWeHVHVVp2gVZUko5N6xOG2PE9yfe1xwiWwMS1Ae7aad5/J1CuVanfDTVrn3FjRLoUWhXtJVe0RsxtqXaYXJOHIiyMSycaG3M5vdUBluCUYCQzc2Pd4lWIhFXtsz3lHg07645OkBh1dTIm8p6scZ+iQMfE3p/AgCVv3+esEwoHombFs7htKJQebVemnewvFJkt7kN8aa/jyzWE31uf00lR7TTNzAyIAJW8odfDqy9DlIfxDmN6muyZ8SfHXGu0Wt3NmqZexTdvJgiVfBVwHEKRIB0s6EEL2U8+TyzJa3BzdnjIWxO+OxqQgMa3DDjzghzvt/+/HduHSHRuSaUlcvfKJwdDcKUDmG/gp5PZWfSiHPax3/JTYLGmLeFzj6YggN5Q6fjQexeKCXG5o6Z8Hh99Pr2Lze4jsujoBeLkdoljMY3t5O0wwPYt4rOIqlXuos1FCajv2rg0EwGcEKiOz7sovwwNY0Hm8L3jbNJgrM0/SammqhBljtsogmLy9Lg/2jwfCkEbOilnWpZmG+3M1ur9NhLz3nP0WJ5jNJj60=
  # LAMBDA_ROLE
  - secure: f6Tuo3Pk2v40or9ROtLw0s4mTJ1LstZC8XeAbm7Hp1GDkQ5yMyOoKUT8UOTpYs9BjRKrVCosCZ5dlT3sEtjDj2sv13NEb7AMUZbqJ8JYR2WcZBNn/sKAl3j7SVDVc5G1+cj+e6synbagibtEESMpu9wXRjC4GEJCJYyy02pwDdWsANA2UzW10wvmEBeD7rTYMW37PNNtmt2cKGjJQopzA09TUjBWyxghCYiGTHq2HDWvFKf4BPH4RzW2Il2l33KSZU8/zT69vG5tFyxJ+gL3T7oqdj+1S94JAVx6YN7Mjp38hdfO2pphLbO6p5On5zkTWPgr4EU921tmRm9pP8UauQbK3ysHACuplotIeBicN6dQ4zsQ3rAYqVhktp+nBJnnqA7OeQK1QrztroyyUb71JzXZenjN8SnTe5FL5ZiCYd3wJZn8cs5ouPCdJ/JuNIrnTE5KY/onkSqPFQnOAZ4DJkyxXqP5BKomodDasM9X+L1HH3fPquELQHmiWdPqnL8s4DbRAkyg+gKG+/yhMYu8KJa7S7D63f1DJ/fmePLKeoOWnAOGeSL7JQ8I45h+0hvYqt+o9tX8X76tE0jbmNRHXpc++tab5G/XCbMoahUSAaPLMGpyBhvpghyDrtJiP+dxgFUe/eVTdG1mDeuHoR1HHDB6qS4XbkN0HOTQFMlRuc0=
  # AWS_ACCESS_KEY
  - secure: V5Fc5ARTSo5lS0WkKWVcPZ9D2shDCCuYxycjcOHhiivTtAO6jpeN/TLCrq5R6tVqCxQiu7iXPEvZscxG4Q30tvjF8lzfw40waNbcDb+T1z3nZDbi3I2x5h1YXfBcTqoUeeXm7qjOE9a/3eFA9LeHdPvMKJByoLwGNe4wVl/mNOB3jqhRhxv1Hii1OGhx3nhldm71MWbqm9W7H7b3N9xszdI7o5yVpWWxbqctA3GEgRSxWxm9cFPY2NZXS4GydLOnpyibh6RiBQ/lA7WGdJKg4KlgO2N2SnMi2HUZO/fJNw2RjzYTNw/K7dbc9zrOJv4NSRfED6KR7sVMjt9mkrcqHSLgm41wm3D6HzDDi7UWejx1NRJftrbPQq+4gbU/izs9yzuvVo/6U/0tj3g6e8FvhSyJe+aC4zLhI00BvYoSLmTtsqiWzSD82cKRzMGKKmI4z3bpD8Ai52oI3fzYrsYA9S7aU4P2u9mtJoZt0Z3hOdudVIxqwzqBtDJaKsZQSK7H2tGTVFBu++8YgqwRxh8UB8P56A/zxtKolxnDGm553Uwa3cGee6lSQarRtGjM0E2oTbFLvpN5UCw2neDkeYmrdHrP96MP/tRWP7bgvtfa2PBL0JNuz+FX6xYl44JgWr9QX+FI++lwlMy3Olp9XNrUVroyKMIbh00hXAGXXgqryo8=
  #AWS_SECRET_ACCESS_KEY
  - secure: EVkSb0IeqYi9NMRojI6tSmieQtwj3J2yHTXZQbpp1oQHp8XomFDOouumYaAcQGNes+WN1V2jnzgbycBzhzyihTmOcGxPZGzlAKaPqyOZ0RmoNdT5zzToWVvmWhpfmOhjEqIwpGCCow5S+D/VoL5NOLTERKKRc/L/E3qfajP+fERv3JF123RwYyWh09CxiG5XfudAzfKLoYlR9Cdw74P4imi5g/tKr3zq3WE6fkWqzmC4dFu8Xxp4Ytb+vex67x3IuhFS1P3x25IDMyRGs0b5FErkadaJmG/CMDzW5UV/TWhtTwLFGnLY/U3a94at/f+J3ADcHi5s/sCGWlwjoSUPuD6D1X+DcSWNIeT9Wel3pIYCau28mTmWBq5gwVMvAIHiHiOxdsUUPXmkOi32xCAiDcjn8m+n5ig2BRJORfxErUCWo9VSQz2NvM6MSTRcUV9pEWlfopgIfZ5Zvr89P/qpaYdTgYqrCNF0vWUZSV+NdvTrgwyp30om0ZnvtC2r9qMykHFHwA7gGDumg4p34/6Cvuch0/fN6hr4U4ZlMIXjeTQI2NoHCchKtjSQfkzsOhArDG32Z/nO1M7WLK/qPkrPmg2tN0WF1w44SHy8RrVlFjg6dodyrgfwny4JvgLt3InfncHlvY1w1lTyPJLVSvSlJYrsOxeUqn0Ey4BdggoUfXY=
  # DB_HOST
  - secure: KiSBpYwiDzueRvEJgPGpo3ZWHyP4ZwSOIzLIoVFBusB0vz9JUb1BB/gXwNjme/BvV79/MLLvpbvN9qkfUpCL4sefzSf2np8x2L9Y4vuV2fycwx6lo2E5d3x9kBgD/+qq5our+RUThqaH50Ae/9B3avLvh0T4MZbFGxc3laRM/sW8jQKrQGYJnTUeVMW1+GHR0I7E6Ip+TrPhs816HtkMasjUCZbMJuNdRqvvuV6NtdUPXA7ABMWwi46bvuYBfoKUnnOYD8CvdEOFrqm2oz+u34u7qgEICEkdS17VUEdyYdnMjHYGOG9eAoyrM9SiRk2F9YCE0UgGmGnOo/jp8YZGvzsMMEfRX4uVGbpKlrosnI783VDUvqsAi20sBaO9rfM5oDu0ADTYbTBbU/yMSiKYXNdVBJXJeQPO4iq1og+n3/pCQC8yxLH/BROFnovKOCIoen8gl9kMJjVFnAmIiX5P1bKXv8z5H0oLo4qJwPUtX2QMqTcybeUswfjJmhmb37jNlH927hgE8Iye1hjQnnooPUq1sfe/BQh/qdzJBUzLSGoMz+IqpLXP33WAL4CP/huHxyFUbwREiGztoIPCSr3hp/I1fHvblS4oo4rRZBNlHnmIKd/HAQOEFKYMxRMb0arVdDmfawrLoNG0etOm9q1A19von3o6G3EIOPve5Xk9/Ek=
  # DB_PASSWORD
  - secure: raWBXwxP+1JlUVoSK8U+UV5YIwt/HbbPzL471EaV8t1CafGpxQtZ/NIyUnsyhm7eayLWbZsIxf8Yy1IHJd10YTSmwUDQjgMVB8MBHqdTX3BzhAQfY1ai/6EnT0x9oSF4RSX4uj94h4NCm6wyAQN5G17Ecs/sm3y18kPomHZF7QJD1NFWo3Qrs2L5c1A7wX3tRFvKqPyizbJLD+X44P1Ewu/Kz2VskAl1FCCp0xC61gBcRAfM4ZQR1MXZE8xDZ/vqQlbm4R+fmtTWrCredb5j/16ZM46N1F4a4VFZGYdLK5H5ZmEbntkjMFXYqHcD5syR5KXs4JiU25Kifuiqtq8eqAByNZGGxs8AKQCw0PuVoLZ3S5X2NqGwByEaDnEUcMTXZ7HiQk1/EGkws8oN263+9TLPtzMLTXFaMWKITYQoIG4nAeZS80FSyppgdjjeFV/r3w3ZSyTH6aak79I4B8Z6PiUqQoTbvcB5rHgn8S8C68EVcx09Va7ZwKIBz60Zh14mbaJw1mByBQEaVE94Zfqfda0hbMQTyv1rT45osOk7QV0bLI5W3brwk8WXCMx86Q6D4Y1gHg57MqdgphW1RlUW1DIWwcZf0heivLlSH4tzMJUEKyxS80au1/Xb8BQ6qvnyd1t/OeXyKp6ADBHLZ9yQoi9VdMbwCwMYveadzlST/+s=
  # DB_USERNAME
  - secure: ap+TgEANs6kU6giJRQDRf8BnkE59PWCmFxGh9tJ7DuRBBtQ3c9HsI6EyFb6k/6uWyywoKF63sE0tqTRE50b1xng3PXcmpM3CMPK0u806+WLctQH9MFcl0Vj0hPJaf/O7zcTc9HgoX79QE5kf2UvMczQpS/M4RNDBQ9u0Rp9/fXb5Pu7NichCuL2orjWRXYWO7ZkkVISM5k+LGWnRs5rWDchl1Q8DYkbO78q+o6bCRKbBb/cd7gVGOSVnlKZdPYfSNBuq3Ih1jzmcoqSSxusyiTW+90HnEWC15RiS2aKb58C4/StQujLrzMOGm+KY5dFn95TaOiFgmDh9cXBT15acgHZGOUANeyFIg92mZz3ah90DKBMKdgf6dolUoYMDY4+3EP2F+QUQlg7SRt22DBUtjygC4BimXkV+itOJQbgT/NfwOyUqeKe8Zv2FBwhwHTR1/MSUrbwhIyDWv7nb/YYv7yL8p2bI1pkNf0mCeAMB+RekM3KlhdBzkQ0sSpyqtkwJxgCRj5HLy0GbCklJ8huJddJPpxDhxaY5EcBg+GH2hOrlBAfTGjWqZStMTJqU4uwsWh45Soa3zqm4XovKgc4awt6uI2I2cf4YkyBdLPwH1IquMH6lSzQfMQXQ7Y+2FJsZNV5YsGgHYp2jq9BHrEN+wNYJz7P4pNDR3bmvCMLyE3A=
  # DB_NAME
  - secure: JAIKCJTKGfNfPuRie6YvwoZKLV4HwEtZxAnKwaw1j2V/fY8vnnpMbTPOnZuk79KAA23AHslevvGP+D7Uz3+W9FiQ9JAoIL0cq2gDfHHHT7ZFKFrq/pQvCTzRhWVoJcxaDXqKZsNKA0RBnebi3Hdxu6ChVkRvScPJ0vWB6RjnP4o9EYxvthNr5yNgFOwPxdSlGavQZHCIkV8T91sx1Wvqrwx8ZvyiOMKiNteO3O5TiqeOt7nPAydMriUhcHQsNw4V5w1eMRjibBoY1lIqONlihFJz3OIaVyrCxAjIyj4XDdLIZTFdMIR6NuaKscVoqHYGa39zxFnAGXjUaA4Pi2bwP1KOr8401a4bU5mlcYNOMz2Ljsmu4+LLq9hUCdROrLEZSJVP54XGTctBB0nj8MnrebYdn04vpzgRs6fgy94HMHyQ7sqmpyGoSRVH8P8hw0N1hXN76FEVmxO9ySA7jLVt4ROxn4YCYA1xBtwjXcH3DWlSnRE61imv27d3Q/f2QZyLOp4C5mWeQaHQkxrG9t1tLVm5UhzD1w7Dsdzup5ldKMEBMD1WiqGHF/g+mMN13E0Je3eP2nwLSsRD0lnueEw2jINyWr0xRH9X41JRKOeH4Dz96qnnlbPuUBnEAC0PdFSAbOxV7zTr8tW+a/Tcgjstm0fgH659sVYP7da5peOeTn0=
  # CODE_CLIMATE_TOKEN
  - secure: ClEYeHI4p+OuXuNEMb5Ks0p1faeBw5vSH4B8LST1lhjbUE4EL83PH8du8kcrnlzpmVMKJ9/5pQ/SEGIUFAY7XkAGnPtegcC1YL0zzHYgksBym9ku8WqUHJcywdHbskrXT0TZLSSpADQwR3RpE1CQApeG8+9ujpxWhhWXY7BISeN70bR19LdmyZIx6EmIILKfJ/8L3bHC9nB1JsxNI5OK6A0MCmIH80LUXTXeXYlPO39/oa+0gJ49ueXjQLHQ9zw/3D0F3HXtBoPc00P7ZVM5kzvTkNwy9JFEi/FyJiQtkW9iq2OxqX8q5XgjcL2nsPg8XXH70iu7fo482co+nXfVqbFdt3ORr7qvujQvRvB/QmxWu6AQkro7eqyzpKYjX1Yv9CXfrFM5rg7tbk98B+20RAV+qUVPBWKmMOa3YrpM/pr0HLb6gihu62oHa2y7kkHB+8FrrKQit6Mmvp3AwXV3Zp6l+Gw8Dyk7S/SGjD8U1TxvsRHFPyEOm3qZhL47djpQAE2238ne/5rPhtNEh49ghVUi8ej0dQythJwYbt5rYEZrnQnW/ryz1g8pG9fCIT/PmxVBMQ/fA9wQfjpXrk8YWTZi7hr1pSLU4Mwg6gNGflOsUp7UvLbDnuh4u8jVz0VktkvUYI6xHa32xJlPLFSQgHTH2g81L2iLKadCBFlKrd4=
before_deploy:
- "./node_modules/.bin/webpack"
- DATABASE_HOST=$DB_HOST DATABASE_USER=$DB_USERNAME DATABASE_PASSWORD=$DB_PASSWORD
  DATABASE_NAME=$DB_NAME npm run migrate
deploy:
  provider: lambda
  function_name: "$LAMBDA_FUNCTION_NAME"
  region: "$LAMBDA_REGION"
  role: "$LAMBDA_ROLE"
  runtime: nodejs6.10
  handler_name: handler
  access_key_id: "$AWS_ACCESS_KEY"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
